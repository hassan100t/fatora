<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù†Ø¸Ø§Ù… Ø§Ù„ÙÙˆØ§ØªÙŠØ± Ø§Ù„Ù…ØªÙƒØ§Ù…Ù„</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;500;700&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>
        :root {
            --primary-color: #ff7b00;
            --secondary-color: #fff5eb;
            --accent-color: #ff9800;
            --danger-color: #f44336;
            --success-color: #4CAF50;
            --save-color: #2196F3;
            --clear-color: #607d8b;
            --download-color: #673AB7;
            --pdf-color: #E91E63;
            --text-color: #333;
            --border-color: #ddd;
            --discount-color: #9c27b0;
            --footer-color: #f8f9fa;
        }
        
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        
        body {
            font-family: 'Tajawal', Arial, sans-serif;
            background-color: #f5f5f5;
            color: var(--text-color);
            line-height: 1.6;
            display: flex;
            flex-direction: column;
            min-height: 100vh;
        }

        .top-prayer {
            background-color: var(--secondary-color);
            color: var(--primary-color);
            text-align: center;
            padding: 10px 0;
            font-size: 1.2rem;
            font-weight: bold;
            border-bottom: 1px solid var(--border-color);
        }

        .bottom-prayer {
            background-color: var(--footer-color);
            color: black;
            text-align: center;
            padding: 15px 0;
            font-size: 1rem;
            border-top: 1px solid var(--border-color);
            margin-top: auto;
        }
        
        .container {
            width: 100%;
            max-width: 1200px;
            margin: 20px auto;
            padding: 20px;
            background: white;
            box-shadow: 0 0 20px rgba(0,0,0,0.1);
            border-radius: 10px;
            flex: 1;
        }
        
        .header {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 1px solid var(--border-color);
        }
        
        .title-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin-bottom: 15px;
            width: 100%;
        }
        
        #system-title {
            color: var(--primary-color);
            margin: 0;
            font-size: 2rem;
            text-align: center;
            transition: all 0.3s ease;
        }
        
        .title-input-container {
            width: 100%;
            max-width: 500px;
            margin-top: 15px;
        }
        
        .title-input {
            width: 100%;
            padding: 10px 15px;
            border: 2px solid var(--primary-color);
            border-radius: 30px;
            font-size: 1rem;
            text-align: center;
            background-color: var(--secondary-color);
            transition: all 0.3s ease;
        }
        
        .header-info {
            display: flex;
            justify-content: space-between;
            width: 100%;
            align-items: center;
            flex-wrap: wrap;
            gap: 10px;
        }
        
        .header-details {
            display: flex;
            gap: 20px;
            align-items: center;
            flex-wrap: wrap;
        }
        
        .invoice-date, .live-time {
            font-weight: bold;
            font-size: 1.1rem;
            color: var(--primary-color);
            background-color: var(--secondary-color);
            padding: 8px 15px;
            border-radius: 30px;
            white-space: nowrap;
        }
        
        .invoice-number {
            font-weight: bold;
            font-size: 1.1rem;
            color: var(--primary-color);
            background-color: var(--secondary-color);
            padding: 8px 15px;
            border-radius: 30px;
            white-space: nowrap;
        }
        
        .invoice-number-input {
            border: 1px solid var(--primary-color);
            padding: 5px 10px;
            width: 80px;
            text-align: center;
            border-radius: 15px;
            margin-right: 5px;
            background-color: var(--secondary-color);
            font-family: 'Tajawal', Arial, sans-serif;
            font-size: 1rem;
        }
        
        .table-container {
            width: 100%;
            overflow-x: auto;
            margin-bottom: 20px;
        }
        
        .invoice-table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 15px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            min-width: 700px;
        }
        
        .invoice-table th {
            background-color: var(--primary-color);
            color: white;
            padding: 12px;
            text-align: center;
            border: 1px solid var(--border-color);
            font-weight: 700;
        }
        
        .invoice-table td {
            padding: 10px;
            text-align: center;
            border: 1px solid var(--border-color);
        }
        
        .editable {
            background-color: var(--secondary-color);
            min-width: 80px;
            transition: all 0.3s;
        }
        
        .editable:focus {
            background-color: #fff0e0;
            outline: 2px solid var(--accent-color);
        }
        
        .totals {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 25px;
        }
        
        .total-box {
            padding: 15px;
            border-radius: 8px;
            background-color: white;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            text-align: center;
        }
        
        .total-box h3 {
            color: var(--primary-color);
            margin-bottom: 10px;
            font-size: 1.1rem;
        }
        
        .total-box p {
            font-size: 1.2rem;
            font-weight: bold;
        }
        
        .discount-box {
            border-top: 3px solid var(--discount-color);
        }
        
        .discount-box h3 {
            color: var(--discount-color);
        }
        
        .action-buttons {
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            gap: 10px;
            margin: 25px 0;
        }
        
        .btn {
            padding: 10px 25px;
            color: white;
            border: none;
            border-radius: 30px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: bold;
            transition: all 0.3s ease;
            min-width: 150px;
            text-align: center;
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        
        .btn-telegram {
            background-color: var(--primary-color);
        }
        
        .btn-add {
            background-color: var(--accent-color);
            margin: 15px auto;
            width: 220px;
            display: block;
        }
        
        .btn-reset {
            background-color: #6c757d;
        }
        
        .btn-delete {
            background-color: var(--danger-color);
        }
        
        .btn-print {
            background-color: var(--success-color);
        }
        
        .btn-save {
            background-color: var(--save-color);
        }
        
        .btn-clear {
            background-color: var(--clear-color);
        }
        
        .btn-download {
            background-color: var(--download-color);
        }
        
        .btn-pdf {
            background-color: var(--pdf-color);
        }
        
        .delete-container {
            text-align: center;
            margin: 15px 0;
        }
        
        .highlight {
            animation: highlight 1.5s ease;
        }
        
        @keyframes highlight {
            0% { background-color: var(--secondary-color); }
            50% { background-color: #ffe0c8; }
            100% { background-color: var(--secondary-color); }
        }
        
        @media print {
            .no-print, .top-prayer, .bottom-prayer {
                display: none;
            }
            body {
                padding: 0;
                background: white;
            }
            .container {
                box-shadow: none;
                padding: 10px;
                margin: 0;
                max-width: 100%;
            }
            .invoice-table th {
                background-color: var(--primary-color) !important;
                color: white !important;
                -webkit-print-color-adjust: exact;
                print-color-adjust: exact;
            }
            .invoice-number-input {
                display: none;
            }
        }
        
        @media (max-width: 1024px) {
            .container {
                padding: 15px;
                margin: 15px auto;
            }
            
            #system-title {
                font-size: 1.8rem;
            }
            
            .invoice-table th, 
            .invoice-table td {
                padding: 8px;
                font-size: 0.95rem;
            }
            
            .total-box h3 {
                font-size: 1rem;
            }
            
            .total-box p {
                font-size: 1.1rem;
            }
        }
        
        @media (max-width: 768px) {
            .container {
                padding: 10px;
                margin: 10px auto;
            }
            
            #system-title {
                font-size: 1.5rem;
            }
            
            .header-info {
                flex-direction: column;
                align-items: center;
            }
            
            .invoice-number, .live-time, .invoice-date {
                font-size: 1rem;
                padding: 6px 12px;
            }
            
            .totals {
                grid-template-columns: 1fr 1fr;
            }
            
            .btn {
                min-width: 120px;
                padding: 8px 15px;
                font-size: 0.9rem;
            }
            
            .btn-add {
                width: 180px;
            }
        }
        
        @media (max-width: 480px) {
            #system-title {
                font-size: 1.3rem;
            }
            
            .title-input {
                padding: 8px 12px;
                font-size: 0.9rem;
            }
            
            .totals {
                grid-template-columns: 1fr;
            }
            
            .action-buttons {
                flex-direction: column;
                align-items: center;
            }
            
            .btn {
                width: 100%;
                max-width: 200px;
            }
        }
    </style>
</head>
<body>
    <div class="top-prayer no-print">Ø§Ù„Ù„Ù‡Ù… ØµÙ„ Ø¹Ù„Ù‰ Ù…Ø­Ù…Ø¯ ÙˆØ§Ù„ Ù…Ø­Ù…Ø¯</div>

    <div class="container">
        <div class="header">
            <div class="title-container">
                <h1 id="system-title">Ù†Ø¸Ø§Ù… Ø§Ù„ÙÙˆØ§ØªÙŠØ± Ø§Ù„Ù…ØªÙƒØ§Ù…Ù„</h1>
                <div class="title-input-container no-print">
                    <input type="text" id="title-input" class="title-input" placeholder="ØªØºÙŠÙŠØ± Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ù†Ø¸Ø§Ù…" value="Ù†Ø¸Ø§Ù… Ø§Ù„ÙÙˆØ§ØªÙŠØ± Ø§Ù„Ù…ØªÙƒØ§Ù…Ù„">
                </div>
            </div>
            
            <div class="header-info">
                <div class="header-details">
                    <div class="invoice-date" id="invoice-date"></div>
                    <div class="live-time" id="live-time"></div>
                </div>
                <div class="invoice-number no-print">
                    Ø±Ù‚Ù… Ø§Ù„ÙØ§ØªÙˆØ±Ø©: 
                    <input type="text" id="invoice-number-input" class="invoice-number-input" value="1">
                </div>
                <div class="invoice-number print-only" style="display:none;">
                    Ø±Ù‚Ù… Ø§Ù„ÙØ§ØªÙˆØ±Ø©: <span id="invoice-number-display">1</span>
                </div>
            </div>
        </div>
        
        <div class="table-container">
            <table class="invoice-table">
                <thead>
                    <tr>
                        <th>Ø±Ù‚Ù…</th>
                        <th>Ø§Ø³Ù… Ø§Ù„Ù…Ø§Ø¯Ø©</th>
                        <th>Ø§Ù„Ø³Ø¹Ø±</th>
                        <th>Ø§Ù„ÙƒÙ…ÙŠØ©</th>
                        <th>Ø§Ù„Ø®ØµÙ… %</th>
                        <th>Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹</th>
                        <th>Ø§Ù„ÙˆØ§ØµÙ„</th>
                    </tr>
                </thead>
                <tbody id="invoice-data">
                    <!-- Ø³ÙŠØªÙ… Ù…Ù„Ø¡ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù‡Ù†Ø§ -->
                </tbody>
            </table>
        </div>
        
        <div class="delete-container no-print">
            <button class="btn btn-delete" id="delete-btn">
                <span>Ø­Ø°Ù Ø§Ù„ØµÙ Ø§Ù„Ù…Ø­Ø¯Ø¯</span>
            </button>
        </div>
        
        <button class="btn btn-add no-print" id="add-row-btn">
            <span>Ø¥Ø¶Ø§ÙØ© ÙØ§ØªÙˆØ±Ø© Ø¬Ø¯ÙŠØ¯Ø©</span>
        </button>
        
        <div class="totals">
            <div class="total-box">
                <h3>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø¨Ø§Ù„Øº:</h3>
                <p id="total-amount">0 Ø¯.Ø¹</p>
            </div>
            <div class="total-box discount-box">
                <h3>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø®ØµÙ…:</h3>
                <p id="total-discount">0 Ø¯.Ø¹</p>
            </div>
            <div class="total-box">
                <h3>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø¨Ø¹Ø¯ Ø§Ù„Ø®ØµÙ…:</h3>
                <p id="total-after-discount">0 Ø¯.Ø¹</p>
            </div>
            <div class="total-box">
                <h3>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ÙˆØ§ØµÙ„:</h3>
                <p id="total-received">0 Ø¯.Ø¹</p>
            </div>
            <div class="total-box">
                <h3>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ:</h3>
                <p id="total-balance">0 Ø¯.Ø¹</p>
            </div>
        </div>
        
        <div class="action-buttons no-print">
            <button class="btn btn-reset" id="reset-btn">
                <span>ØªØµÙÙŠØ± Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù‚ÙŠÙ…</span>
            </button>
            <button class="btn btn-save" id="save-btn">
                <span>Ø­ÙØ¸ Ø§Ù„ÙØ§ØªÙˆØ±Ø©</span>
            </button>
            <button class="btn btn-download" id="download-btn">
                <span>ØªÙ†Ø²ÙŠÙ„ ÙƒÙ…Ù„Ù Excel</span>
            </button>
            <button class="btn btn-pdf" id="pdf-btn">
                <span>ØªÙ†Ø²ÙŠÙ„ ÙƒÙ…Ù„Ù PDF</span>
            </button>
            <button class="btn btn-telegram" id="telegram-btn">
                <span>Ø¥Ø±Ø³Ø§Ù„ Ø¹Ø¨Ø± Ø§Ù„ØªÙ„ÙŠØ¬Ø±Ø§Ù…</span>
            </button>
            <button class="btn btn-print" id="print-btn">
                <span>Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„ØªÙ‚Ø±ÙŠØ±</span>
            </button>
            <button class="btn btn-clear" id="clear-btn">
                <span>Ù…Ø³Ø­ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø­ÙÙˆØ¸Ø©</span>
            </button>
        </div>
    </div>
    
    <div class="bottom-prayer no-print">
        Ø±Ø­Ù…Ø© Ø§Ù„Ù„Ù‡ Ù…Ù† Ù‚Ø±Ø£ Ø³ÙˆØ±Ø© Ø§Ù„ÙØ§ØªØ­Ø© Ø¥Ù„Ù‰ Ø±ÙˆØ­ Ø§Ù„Ù…Ø±Ø­ÙˆÙ… Ø¹Ù„ÙŠ Ø·Ø±ÙˆÙŠÙ„ Ø±Ø§Ø¶ÙŠ
    </div>

    <script>
        // Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ÙÙˆØ§ØªÙŠØ±
        let invoices = [
            { id: 1, item: "", price: "", quantity: "", discount: "0", total: "", received: "" },
            { id: 2, item: "", price: "", quantity: "", discount: "0", total: "", received: "" }
        ];
        
        let selectedRowIndex = -1;

        // Ø¯Ø§Ù„Ø© Ù„ØªØ­Ø¯ÙŠØ« Ø§Ù„ØªØ§Ø±ÙŠØ® ÙˆØ§Ù„ÙˆÙ‚Øª
        function updateDateTime() {
            const now = new Date();
            const dateStr = now.toLocaleDateString('ar-EG');
            document.getElementById("invoice-date").textContent = `ØªØ§Ø±ÙŠØ® Ø§Ù„ÙØ§ØªÙˆØ±Ø©: ${dateStr}`;
            
            let hours = now.getHours();
            const minutes = now.getMinutes().toString().padStart(2, '0');
            const seconds = now.getSeconds().toString().padStart(2, '0');
            const ampm = hours >= 12 ? 'Ù…' : 'Øµ';
            hours = hours % 12 || 12;
            
            document.getElementById("live-time").textContent = `${hours}:${minutes}:${seconds} ${ampm}`;
        }

        // Ø¯Ø§Ù„Ø© Ù„ØªØ­Ø¯ÙŠØ« Ø±Ù‚Ù… Ø§Ù„ÙØ§ØªÙˆØ±Ø©
        function updateInvoiceNumber() {
            const input = document.getElementById("invoice-number-input");
            const display = document.getElementById("invoice-number-display");
            let num = parseInt(input.value) || 1;
            num = Math.max(1, num);
            input.value = num;
            display.textContent = num;
            
            // ØªØ­Ø¯ÙŠØ« Ø£Ø±Ù‚Ø§Ù… Ø§Ù„ØµÙÙˆÙ
            invoices.forEach((invoice, index) => {
                invoice.id = num + index;
            });
            renderInvoices();
        }

        // Ø¯Ø§Ù„Ø© Ù„Ø¹Ø±Ø¶ Ø§Ù„ÙÙˆØ§ØªÙŠØ± ÙÙŠ Ø§Ù„Ø¬Ø¯ÙˆÙ„
        function renderInvoices() {
            const tableBody = document.getElementById("invoice-data");
            tableBody.innerHTML = "";
            
            invoices.forEach((invoice, index) => {
                const row = document.createElement("tr");
                
                // Ø¥Ø¶Ø§ÙØ© Ø­Ø¯Ø« Ø§Ù„Ù†Ù‚Ø± Ù„ØªØ­Ø¯ÙŠØ¯ Ø§Ù„ØµÙ
                row.addEventListener('click', () => {
                    document.querySelectorAll("#invoice-data tr").forEach(r => {
                        r.style.backgroundColor = "";
                    });
                    row.style.backgroundColor = "#e3f2fd";
                    selectedRowIndex = index;
                });
                
                // Ø¥Ù†Ø´Ø§Ø¡ Ø®Ù„Ø§ÙŠØ§ Ø§Ù„ØµÙ
                const cells = [
                    createCell(invoice.id, false),
                    createEditableCell(invoice.item, (value) => {
                        invoices[index].item = value;
                    }, () => row.cells[2].focus()),
                    createEditableCell(invoice.price, (value) => {
                        invoices[index].price = value.replace(/\D/g, '') || "";
                        calculateRowTotal(index);
                    }, () => row.cells[3].focus()),
                    createEditableCell(invoice.quantity, (value) => {
                        invoices[index].quantity = value.replace(/\D/g, '') || "";
                        calculateRowTotal(index);
                    }, () => row.cells[4].focus()),
                    createEditableCell(invoice.discount, (value) => {
                        let discount = value.replace(/\D/g, '') || "0";
                        discount = Math.min(100, Math.max(0, parseInt(discount))).toString();
                        invoices[index].discount = discount;
                        calculateRowTotal(index);
                    }, () => row.cells[5].focus()),
                    createCell(invoice.total, false),
                    createEditableCell(invoice.received, (value) => {
                        invoices[index].received = value.replace(/\D/g, '') || "";
                        updateTotals();
                    }, () => {
                        if (index < invoices.length - 1) {
                            document.getElementById("invoice-data").rows[index + 1].cells[1].focus();
                        } else {
                            addNewRow();
                        }
                    })
                ];
                
                cells.forEach(cell => row.appendChild(cell));
                tableBody.appendChild(row);
            });
            
            updateTotals();
        }

        // Ø¯Ø§Ù„Ø© Ù…Ø³Ø§Ø¹Ø¯Ø© Ù„Ø¥Ù†Ø´Ø§Ø¡ Ø®Ù„ÙŠØ© Ø¹Ø§Ø¯ÙŠØ©
        function createCell(content, isEditable) {
            const cell = document.createElement("td");
            cell.textContent = content;
            return cell;
        }

        // Ø¯Ø§Ù„Ø© Ù…Ø³Ø§Ø¹Ø¯Ø© Ù„Ø¥Ù†Ø´Ø§Ø¡ Ø®Ù„ÙŠØ© Ù‚Ø§Ø¨Ù„Ø© Ù„Ù„ØªØ­Ø±ÙŠØ±
        function createEditableCell(content, onBlur, onEnter) {
            const cell = document.createElement("td");
            cell.contentEditable = true;
            cell.className = "editable";
            cell.textContent = content;
            
            cell.addEventListener('blur', () => {
                onBlur(cell.textContent);
                cell.classList.add('highlight');
                setTimeout(() => cell.classList.remove('highlight'), 1500);
            });
            
            cell.addEventListener('keydown', (e) => {
                if (e.key === 'Enter') {
                    e.preventDefault();
                    onEnter();
                }
            });
            
            return cell;
        }

        // Ø¯Ø§Ù„Ø© Ù„Ø­Ø³Ø§Ø¨ Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹ Ù„Ù„ØµÙ
        function calculateRowTotal(index) {
            const price = parseInt(invoices[index].price) || 0;
            const quantity = parseInt(invoices[index].quantity) || 0;
            const discount = parseInt(invoices[index].discount) || 0;
            
            const subtotal = price * quantity;
            const discountAmount = Math.round(subtotal * discount / 100);
            const total = subtotal - discountAmount;
            
            invoices[index].total = total > 0 ? total.toString() : "";
            invoices[index].received = invoices[index].total;
            
            const rows = document.getElementById("invoice-data").rows;
            if (rows[index]) {
                rows[index].cells[5].textContent = invoices[index].total || "";
                rows[index].cells[6].textContent = invoices[index].received || "";
            }
            
            updateTotals();
        }

        // Ø¯Ø§Ù„Ø© Ù„ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ø¬Ø§Ù…ÙŠØ¹
        function updateTotals() {
            let totals = {
                amount: 0,
                discount: 0,
                received: 0
            };
            
            invoices.forEach(invoice => {
                const price = parseInt(invoice.price) || 0;
                const quantity = parseInt(invoice.quantity) || 0;
                const discount = parseInt(invoice.discount) || 0;
                
                const subtotal = price * quantity;
                const discountAmount = Math.round(subtotal * discount / 100);
                
                totals.amount += subtotal;
                totals.discount += discountAmount;
                totals.received += parseInt(invoice.received) || 0;
            });
            
            const afterDiscount = totals.amount - totals.discount;
            const balance = afterDiscount - totals.received;
            
            document.getElementById("total-amount").textContent = `${totals.amount.toLocaleString('ar-EG')} Ø¯.Ø¹`;
            document.getElementById("total-discount").textContent = `${totals.discount.toLocaleString('ar-EG')} Ø¯.Ø¹`;
            document.getElementById("total-after-discount").textContent = `${afterDiscount.toLocaleString('ar-EG')} Ø¯.Ø¹`;
            document.getElementById("total-received").textContent = `${totals.received.toLocaleString('ar-EG')} Ø¯.Ø¹`;
            document.getElementById("total-balance").textContent = `${balance.toLocaleString('ar-EG')} Ø¯.Ø¹`;
        }

        // Ø¯Ø§Ù„Ø© Ù„Ø¥Ø¶Ø§ÙØ© ØµÙ Ø¬Ø¯ÙŠØ¯
        function addNewRow() {
            const invoiceNumber = parseInt(document.getElementById("invoice-number-input").value) || 1;
            const newId = invoiceNumber + invoices.length;
            
            invoices.push({
                id: newId,
                item: "",
                price: "",
                quantity: "",
                discount: "0",
                total: "",
                received: ""
            });
            
            renderInvoices();
            
            // Ø§Ù„ØªØ±ÙƒÙŠØ² Ø¹Ù„Ù‰ Ø®Ù„ÙŠØ© Ø§Ø³Ù… Ø§Ù„Ù…Ø§Ø¯Ø© ÙÙŠ Ø§Ù„ØµÙ Ø§Ù„Ø¬Ø¯ÙŠØ¯
            setTimeout(() => {
                const rows = document.getElementById("invoice-data").rows;
                rows[rows.length - 1].cells[1].focus();
            }, 0);
        }

        // Ø¯Ø§Ù„Ø© Ù„Ø­Ø°Ù Ø§Ù„ØµÙ Ø§Ù„Ù…Ø­Ø¯Ø¯
        function deleteSelectedRow() {
            if (selectedRowIndex === -1) {
                alert("Ø§Ù„Ø±Ø¬Ø§Ø¡ ØªØ­Ø¯ÙŠØ¯ ØµÙ Ù„Ø­Ø°ÙÙ‡");
                return;
            }
            
            if (confirm("Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„ØµÙØŸ")) {
                invoices.splice(selectedRowIndex, 1);
                selectedRowIndex = -1;
                renderInvoices();
            }
        }

        // Ø¯Ø§Ù„Ø© Ù„ØªØµÙÙŠØ± Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù‚ÙŠÙ…
        function resetAllValues() {
            if (confirm("Ù‡Ù„ ØªØ±ÙŠØ¯ ØªØµÙÙŠØ± Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù‚ÙŠÙ… ÙÙŠ Ø§Ù„Ø¬Ø¯ÙˆÙ„ØŸ")) {
                invoices = [
                    { id: 1, item: "", price: "", quantity: "", discount: "0", total: "", received: "" },
                    { id: 2, item: "", price: "", quantity: "", discount: "0", total: "", received: "" }
                ];
                document.getElementById("invoice-number-input").value = "1";
                updateInvoiceNumber();
            }
        }

        // Ø¯Ø§Ù„Ø© Ù„Ø­ÙØ¸ Ø§Ù„ÙØ§ØªÙˆØ±Ø©
        function saveInvoice() {
            try {
                const invoiceData = {
                    title: document.getElementById("title-input").value,
                    invoiceNumber: document.getElementById("invoice-number-input").value,
                    invoices: invoices,
                    totals: {
                        amount: document.getElementById("total-amount").textContent,
                        discount: document.getElementById("total-discount").textContent,
                        afterDiscount: document.getElementById("total-after-discount").textContent,
                        received: document.getElementById("total-received").textContent,
                        balance: document.getElementById("total-balance").textContent
                    },
                    date: document.getElementById("invoice-date").textContent
                };
                
                localStorage.setItem('savedInvoice', JSON.stringify(invoiceData));
                alert("ØªÙ… Ø­ÙØ¸ Ø§Ù„ÙØ§ØªÙˆØ±Ø© Ø¨Ù†Ø¬Ø§Ø­!");
            } catch (error) {
                alert("Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø­ÙØ¸ Ø§Ù„ÙØ§ØªÙˆØ±Ø©");
                console.error(error);
            }
        }

        // Ø¯Ø§Ù„Ø© Ù„ØªØ­Ù…ÙŠÙ„ Ø§Ù„ÙØ§ØªÙˆØ±Ø© Ø§Ù„Ù…Ø­ÙÙˆØ¸Ø©
        function loadSavedInvoice() {
            try {
                const savedData = localStorage.getItem('savedInvoice');
                if (savedData) {
                    const invoiceData = JSON.parse(savedData);
                    
                    document.getElementById("title-input").value = invoiceData.title;
                    document.getElementById("invoice-number-input").value = invoiceData.invoiceNumber;
                    document.getElementById("system-title").textContent = invoiceData.title;
                    
                    invoices = invoiceData.invoices;
                    renderInvoices();
                    
                    return true;
                }
            } catch (error) {
                console.error(error);
            }
            return false;
        }

        // Ø¯Ø§Ù„Ø© Ù„Ù…Ø³Ø­ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø­ÙÙˆØ¸Ø©
        function clearSavedInvoice() {
            if (confirm("Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ù…Ø³Ø­ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø­ÙÙˆØ¸Ø©ØŸ")) {
                localStorage.removeItem('savedInvoice');
                alert("ØªÙ… Ù…Ø³Ø­ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø­ÙÙˆØ¸Ø© Ø¨Ù†Ø¬Ø§Ø­");
                location.reload();
            }
        }

        // Ø¯Ø§Ù„Ø© Ù„Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ÙØ§ØªÙˆØ±Ø© Ø¹Ø¨Ø± Ø§Ù„ØªÙ„ÙŠØ¬Ø±Ø§Ù…
        function sendToTelegram() {
            let message = `*${document.getElementById("system-title").textContent}*\n\n`;
            message += `ğŸ“… ${document.getElementById("invoice-date").textContent}\n`;
            message += `ğŸ•’ ${document.getElementById("live-time").textContent}\n`;
            message += `ğŸ”¢ Ø±Ù‚Ù… Ø§Ù„ÙØ§ØªÙˆØ±Ø©: ${document.getElementById("invoice-number-input").value}\n\n`;
            
            message += "*ØªÙØ§ØµÙŠÙ„ Ø§Ù„ÙØ§ØªÙˆØ±Ø©*\n";
            message += "--------------------------\n";
            
            invoices.forEach(invoice => {
                if (invoice.item || invoice.price || invoice.quantity) {
                    message += `ğŸ“Œ ${invoice.item || "ØºÙŠØ± Ù…Ø­Ø¯Ø¯"}\n`;
                    message += `ğŸ’° Ø§Ù„Ø³Ø¹Ø±: ${invoice.price || "0"} Ø¯.Ø¹\n`;
                    message += `ğŸ§® Ø§Ù„ÙƒÙ…ÙŠØ©: ${invoice.quantity || "0"}\n`;
                    message += `ğŸ« Ø§Ù„Ø®ØµÙ…: ${invoice.discount || "0"}%\n`;
                    message += `ğŸ’µ Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹: ${invoice.total || "0"} Ø¯.Ø¹\n`;
                    message += `ğŸ’³ Ø§Ù„ÙˆØ§ØµÙ„: ${invoice.received || "0"} Ø¯.Ø¹\n`;
                    message += "--------------------------\n";
                }
            });
            
            message += "\n*Ø§Ù„Ù…Ù„Ø®Øµ*\n";
            message += `ğŸ”¢ Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ: ${document.getElementById("total-amount").textContent}\n`;
            message += `ğŸ« Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø®ØµÙ…: ${document.getElementById("total-discount").textContent}\n`;
            message += `ğŸ’° Ø§Ù„ØµØ§ÙÙŠ: ${document.getElementById("total-after-discount").textContent}\n`;
            message += `ğŸ’³ Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ÙˆØ§ØµÙ„: ${document.getElementById("total-received").textContent}\n`;
            message += `âš–ï¸ Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ: ${document.getElementById("total-balance").textContent}\n\n`;
            
            message += "Ø´ÙƒØ±Ø§Ù‹ Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù…ÙƒÙ… Ù†Ø¸Ø§Ù… Ø§Ù„ÙÙˆØ§ØªÙŠØ± Ø§Ù„Ù…ØªÙƒØ§Ù…Ù„";
            
            const encodedMessage = encodeURIComponent(message);
            window.open(`https://t.me/share/url?url=&text=${encodedMessage}`, '_blank');
        }

        // Ø¯Ø§Ù„Ø© Ù„ØªÙ†Ø²ÙŠÙ„ Ø§Ù„ÙØ§ØªÙˆØ±Ø© ÙƒÙ…Ù„Ù Excel
        function downloadAsExcel() {
            try {
                // Ø¥Ù†Ø´Ø§Ø¡ Ù…ØµÙ†Ù Excel
                const wb = XLSX.utils.book_new();
                
                // ØªØ­Ø¶ÙŠØ± Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ù„ØªØµØ¯ÙŠØ±
                const exportData = invoices.map(invoice => ({
                    "Ø±Ù‚Ù…": invoice.id,
                    "Ø§Ø³Ù… Ø§Ù„Ù…Ø§Ø¯Ø©": invoice.item || "",
                    "Ø§Ù„Ø³Ø¹Ø±": invoice.price || "0",
                    "Ø§Ù„ÙƒÙ…ÙŠØ©": invoice.quantity || "0",
                    "Ø§Ù„Ø®ØµÙ… %": invoice.discount || "0",
                    "Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹": invoice.total || "0",
                    "Ø§Ù„ÙˆØ§ØµÙ„": invoice.received || "0"
                }));
                
                // Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ù„Ø®Øµ
                exportData.push({});
                exportData.push({
                    "Ø§Ø³Ù… Ø§Ù„Ù…Ø§Ø¯Ø©": "Ø§Ù„Ù…Ù„Ø®Øµ",
                    "Ø§Ù„Ø³Ø¹Ø±": document.getElementById("total-amount").textContent
                });
                exportData.push({
                    "Ø§Ø³Ù… Ø§Ù„Ù…Ø§Ø¯Ø©": "Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø®ØµÙ…",
                    "Ø§Ù„Ø³Ø¹Ø±": document.getElementById("total-discount").textContent
                });
                exportData.push({
                    "Ø§Ø³Ù… Ø§Ù„Ù…Ø§Ø¯Ø©": "Ø§Ù„ØµØ§ÙÙŠ Ø¨Ø¹Ø¯ Ø§Ù„Ø®ØµÙ…",
                    "Ø§Ù„Ø³Ø¹Ø±": document.getElementById("total-after-discount").textContent
                });
                exportData.push({
                    "Ø§Ø³Ù… Ø§Ù„Ù…Ø§Ø¯Ø©": "Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ÙˆØ§ØµÙ„",
                    "Ø§Ù„Ø³Ø¹Ø±": document.getElementById("total-received").textContent
                });
                exportData.push({
                    "Ø§Ø³Ù… Ø§Ù„Ù…Ø§Ø¯Ø©": "Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ",
                    "Ø§Ù„Ø³Ø¹Ø±": document.getElementById("total-balance").textContent
                });
                
                // Ø¥Ù†Ø´Ø§Ø¡ ÙˆØ±Ù‚Ø© Ø¹Ù…Ù„
                const ws = XLSX.utils.json_to_sheet(exportData);
                
                // Ø¥Ø¶Ø§ÙØ© ÙˆØ±Ù‚Ø© Ø§Ù„Ø¹Ù…Ù„ Ø¥Ù„Ù‰ Ø§Ù„Ù…ØµÙ†Ù
                XLSX.utils.book_append_sheet(wb, ws, "Ø§Ù„ÙØ§ØªÙˆØ±Ø©");
                
                // Ø¥Ù†Ø´Ø§Ø¡ Ø§Ø³Ù… Ù„Ù„Ù…Ù„Ù
                const fileName = `ÙØ§ØªÙˆØ±Ø©_${document.getElementById("invoice-number-input").value}_${new Date().toISOString().slice(0, 10)}.xlsx`;
                
                // ØªÙ†Ø²ÙŠÙ„ Ø§Ù„Ù…Ù„Ù
                XLSX.writeFile(wb, fileName);
                
                alert("ØªÙ… ØªÙ†Ø²ÙŠÙ„ Ø§Ù„ÙØ§ØªÙˆØ±Ø© ÙƒÙ…Ù„Ù Excel Ø¨Ù†Ø¬Ø§Ø­!");
            } catch (error) {
                alert("Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø¥Ù†Ø´Ø§Ø¡ Ù…Ù„Ù Excel");
                console.error(error);
            }
        }

        // Ø¯Ø§Ù„Ø© Ù„ØªÙ†Ø²ÙŠÙ„ Ø§Ù„ÙØ§ØªÙˆØ±Ø© ÙƒÙ…Ù„Ù PDF
        async function downloadAsPDF() {
            try {
                // Ø¥Ù†Ø´Ø§Ø¡ Ù…Ø³ØªÙ†Ø¯ PDF Ø¬Ø¯ÙŠØ¯
                const { jsPDF } = window.jspdf;
                const doc = new jsPDF('p', 'pt', 'a4');
                
                // Ø¥Ø¹Ø¯Ø§Ø¯ Ø®ÙŠØ§Ø±Ø§Øª html2canvas
                const options = {
                    scale: 2,
                    useCORS: true,
                    allowTaint: true,
                    scrollY: 0
                };
                
                // Ø£Ø®Ø° Ù„Ù‚Ø·Ø© Ù„Ù„Ø¹Ù†ØµØ± Ø§Ù„Ù…Ø·Ù„ÙˆØ¨
                const element = document.querySelector('.container');
                
                // Ø§Ù†ØªØ¸Ø± Ø­ØªÙ‰ ÙŠØªÙ… ØªØ­ÙˆÙŠÙ„ HTML Ø¥Ù„Ù‰ canvas
                const canvas = await html2canvas(element, options);
                
                // Ø¥Ø¶Ø§ÙØ© Ø§Ù„ØµÙˆØ±Ø© Ø¥Ù„Ù‰ PDF
                const imgData = canvas.toDataURL('image/png');
                const imgWidth = doc.internal.pageSize.getWidth() - 40;
                const imgHeight = (canvas.height * imgWidth) / canvas.width;
                
                doc.addImage(imgData, 'PNG', 20, 20, imgWidth, imgHeight);
                
                // Ø­ÙØ¸ Ø§Ù„Ù…Ù„Ù
                const fileName = `ÙØ§ØªÙˆØ±Ø©_${document.getElementById("invoice-number-input").value}_${new Date().toISOString().slice(0, 10)}.pdf`;
                doc.save(fileName);
                
                alert("ØªÙ… ØªÙ†Ø²ÙŠÙ„ Ø§Ù„ÙØ§ØªÙˆØ±Ø© ÙƒÙ…Ù„Ù PDF Ø¨Ù†Ø¬Ø§Ø­!");
            } catch (error) {
                alert("Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø¥Ù†Ø´Ø§Ø¡ Ù…Ù„Ù PDF");
                console.error(error);
            }
        }

        // Ø¯Ø§Ù„Ø© Ù„ØªØºÙŠÙŠØ± Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ù†Ø¸Ø§Ù…
        function updateSystemTitle() {
            const newTitle = document.getElementById("title-input").value || "Ù†Ø¸Ø§Ù… Ø§Ù„ÙÙˆØ§ØªÙŠØ± Ø§Ù„Ù…ØªÙƒØ§Ù…Ù„";
            document.getElementById("system-title").textContent = newTitle;
            document.title = newTitle;
        }

        // ØªÙ‡ÙŠØ¦Ø© Ø§Ù„ØµÙØ­Ø© Ø¹Ù†Ø¯ Ø§Ù„ØªØ­Ù…ÙŠÙ„
        document.addEventListener('DOMContentLoaded', function() {
            // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø­ÙÙˆØ¸Ø© Ø£Ùˆ ØªÙ‡ÙŠØ¦Ø© Ø¬Ø¯ÙŠØ¯Ø©
            if (!loadSavedInvoice()) {
                updateDateTime();
                updateInvoiceNumber();
                renderInvoices();
            }
            
            // ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙˆÙ‚Øª ÙƒÙ„ Ø«Ø§Ù†ÙŠØ©
            setInterval(updateDateTime, 1000);
            
            // Ø¥Ø¹Ø¯Ø§Ø¯ Ø£Ø­Ø¯Ø§Ø« Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„
            document.getElementById("title-input").addEventListener('input', updateSystemTitle);
            document.getElementById("invoice-number-input").addEventListener('change', updateInvoiceNumber);
            
            // Ø¥Ø¹Ø¯Ø§Ø¯ Ø£Ø­Ø¯Ø§Ø« Ø§Ù„Ø£Ø²Ø±Ø§Ø±
            document.getElementById("add-row-btn").addEventListener('click', addNewRow);
            document.getElementById("delete-btn").addEventListener('click', deleteSelectedRow);
            document.getElementById("reset-btn").addEventListener('click', resetAllValues);
            document.getElementById("save-btn").addEventListener('click', saveInvoice);
            document.getElementById("download-btn").addEventListener('click', downloadAsExcel);
            document.getElementById("pdf-btn").addEventListener('click', downloadAsPDF);
            document.getElementById("telegram-btn").addEventListener('click', sendToTelegram);
            document.getElementById("print-btn").addEventListener('click', () => window.print());
            document.getElementById("clear-btn").addEventListener('click', clearSavedInvoice);
            
            // Ø¶Ø¨Ø· Ø§Ù„ØªØ±ÙƒÙŠØ² Ø§Ù„Ø£ÙˆÙ„ÙŠ Ø¹Ù„Ù‰ Ø£ÙˆÙ„ Ø®Ù„ÙŠØ© Ø¥Ø¯Ø®Ø§Ù„
            setTimeout(() => {
                const rows = document.getElementById("invoice-data").rows;
                if (rows.length > 0 && rows[0].cells.length > 1) {
                    rows[0].cells[1].focus();
                }
            }, 100);
        });
    </script>
</body>
</html>